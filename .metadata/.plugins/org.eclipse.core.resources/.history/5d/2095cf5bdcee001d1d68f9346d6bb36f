import java.util.ArrayList;
import java.util.List;
import java.util.Random;

public class Bingo implements Subject {

    private List<Observer> observers;
    private List<Integer> numerosSorteados;
    private List<BingoCard> cartelas;
    private int numCartelas;
    private boolean fimDeJogo;

    public Bingo(int numCartelas) {
        this.observers = new ArrayList<>();
        this.numerosSorteados = new ArrayList<>();
        this.cartelas = new ArrayList<>();
        this.numCartelas = numCartelas;
        this.fimDeJogo = false;
        criarCartelas();
    }

    private void criarCartelas() {
        for (int i = 0; i < numCartelas; i++) {
            cartelas.add(new Cartela());
        }
    }

    private void sortearNumero() {
        Random random = new Random();
        int num = random.nextInt(99) + 1;
        numerosSorteados.add(num);
        System.out.println("Número sorteado: " + num);
        notificarObservers(num);
    }

    public void jogar() {
        System.out.println("Iniciando bingo com " + numCartelas + " cartelas:");
        for (int i = 0; i < numCartelas; i++) {
            System.out.println("Cartela " + (i+1) + ": " + cartelas.get(i).getNumeros());
        }
        while (!fimDeJogo) {
            sortearNumero();
            for (Observer observer : observers) {
                if (((Cartela)observer).isVencedor()) {
                    fimDeJogo = true;
                    break;
                }
            }
        }
        Cartela cartelaVencedora = null;
        for (Observer observer : observers) {
            if (((Cartela)observer).isVencedor()) {
                cartelaVencedora = (Cartela)observer;
                break;
            }
        }
        if (cartelaVencedora != null) {
            System.out.println("Cartela " + (cartelas.indexOf(cartelaVencedora)+1) + " é a vencedora!");
        } else {
            System.out.println("Nenhuma cartela venceu.");
        }
    }

    @Override
    public void registrarObserver(Observer observer) {
        observers.add(observer);
    }

    @Override
    public void removerObserver(Observer observer) {
        observers.remove(observer);
    }

    @Override
    public void notificarObservers(int num) {
        for (Observer observer : observers) {
            observer.atualizar(num);
        }
    }
}
